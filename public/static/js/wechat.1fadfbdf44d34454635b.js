webpackJsonp([22],{"+VNB":function(t,e){},"4S7G":function(t,e,n){"use strict";e.a={setToken:function(t){window.localStorage.setItem("jwt_token",t)},getToken:function(){return window.localStorage.getItem("jwt_token")},removeToken:function(){window.localStorage.removeItem("jwt_token")}}},Dsfc:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n("//Fk"),a=n.n(o),r=n("7+uW"),s=n("/ocq"),u={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},staticRenderFns:[]};var i=n("VU/8")({name:"app"},u,!1,function(t){n("+VNB")},null,null).exports,c=n("mtWM"),p=n.n(c),d=n("dgq6"),h=n("4S7G"),f=this,l=[{path:"/wechat_auth",name:"wechat_auth",component:function(){return n.e(18).then(n.bind(null,"eYe4"))}},{path:"/register",name:"register",component:function(){return n.e(13).then(n.bind(null,"SeBb"))}},{path:"/enterprise_register",name:"enterprise_register",component:function(){return n.e(8).then(n.bind(null,"cakC"))}},{path:"/enterprise_info",name:"enterprise_info",component:function(){return n.e(16).then(n.bind(null,"yfhI"))}},{path:"/worker_list",name:"worker_list",component:function(){return n.e(15).then(n.bind(null,"fUf7"))},meta:{wechatAuth:!0}},{path:"/login/:username",name:"login",component:function(){return n.e(19).then(n.bind(null,"6cqi"))}}],m=new s.a({routes:l});m.beforeEach(function(t,e,n){if(t.path.match("/username/")){var o=t.path.split("/")[2];d.a.dispatch("loginRequest",{username:o,password:o}).then(function(t){console.log(window.localStorage.getItem("user_to_url"))}).catch(function(t){f.$message.error(t.response.data.message)})}if(t.meta.wechatAuth){if(d.a.state.authenticated)return n();axios.post("api/wechat/getOauthURL",{path:t.path}).then(function(e){window.localStorage.setItem("user_to_url",t.path),window.location.href=e.data.data})}return n()});var g=m,w=(n("tvR6"),n("odsO")),v=n("7t+N"),_=n.n(v),T=n("hU7x"),k=n.n(T);window.axios=p.a,window.$=_.a,window.jsonp=k.a,r.default.use(s.a),r.default.use(w.a),p.a.interceptors.request.use(function(t){return h.a.getToken()&&(t.headers.Authorization="Bearer "+h.a.getToken()),t},function(t){return a.a.reject(t)}),p.a.interceptors.response.use(function(t){return t},function(t){return 401==t.response.status||419==t.response.status?(d.a.dispatch("refreshToken"),a.a.reject(t)):a.a.reject(t)}),new r.default({el:"#app",router:g,store:d.a,template:"<App/>",components:{App:i}})},dgq6:function(t,e,n){"use strict";var o=n("7+uW"),a=n("NYxO"),r={state:{username:null,authenticated:!1},mutations:{set_user_auth:function(t,e){t.username=e.user.username,t.authenticated=!0},del_user_auth:function(t){t.username=null,t.authenticated=!1}},actions:{setAuthUser:function(t){var e=t.commit;t.dispatch;return axios.post("/api/user/user").then(function(t){e({type:"set_user_auth",user:t.data})})},delAuthUser:function(t){return(0,t.commit)({type:"del_user_auth"})},refreshToken:function(t){t.commit;var e=t.dispatch;return axios.post("api/auth/refreshToken").then(function(t){e("loginSuccess",t.data)}).catch(function(t){e("logoutRequest")})}}},s=n("//Fk"),u=n.n(s),i=n("4S7G"),c={actions:{loginRequest:function(t,e){var n=t.dispatch;return axios.post("/api/auth/login",e).then(function(t){n("loginSuccess",t.data)}).catch(function(t){return u.a.reject(t)})},loginSuccess:function(t,e){var n=t.dispatch;i.a.setToken(e.token),n("setAuthUser")},logoutRequest:function(t){var e=t.dispatch;return axios.post("/api/user/logout").then(function(t){return i.a.removeToken(),e("delAuthUser"),t})}}};o.default.use(a.a);e.a=new a.a.Store({modules:{AuthUser:r,Login:c}})},odsO:function(t,e,n){"use strict";var o=n("Wxq9");n.n(o);e.a={install:function(t,e){t.prototype.message=function(t){return void 0===t.data.status?this.$message(t.data.msg):1===t.data.status&&void 0===t.data.data?this.$message.success(t.data.msg):this.$message.error(t.data.msg)},t.prototype.formatSelectOptions=function(t){var e=[];for(var n in t)e.push({value:n,label:t[n]});return e},t.prototype.formatSelectOptionsForVux=function(t){var e=[];for(var n in t)e.push({value:n,name:t[n]});return e},t.prototype.formatToTextForAddress=function(t){var e={};return t.forEach(function(t,n){0==n&&(e.province=o.CodeToText[t]),1==n&&(e.city=o.CodeToText[t]),2==n&&(e.district=o.CodeToText[t])}),e},t.prototype.formatToCodeForAddress=function(t,e,n){var a=[];return a[0]=o.TextToCode[t].code,a[1]=o.TextToCode[t][e].code,a[2]=o.TextToCode[t][e][n].code,a},t.prototype.getPermission=function(t){axios.post("api/frontend_permission",t).then(function(t){return t.data.data})}}}},tvR6:function(t,e){}},["Dsfc"]);
//# sourceMappingURL=wechat.1fadfbdf44d34454635b.js.map